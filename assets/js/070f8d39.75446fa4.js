"use strict";(self.webpackChunkwiznet_document=self.webpackChunkwiznet_document||[]).push([[31985],{43006:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var r=n(85893),t=n(11151);const s={id:"mqtt_example",title:"WizFi310 MQTT Example",date:new Date("2020-04-15T00:00:00.000Z")},d=void 0,a={id:"Product/Wi-Fi-Module/WizFi310/Programers-Guide/mqtt_example",title:"WizFi310 MQTT Example",description:"MQTT",source:"@site/docs/Product/Wi-Fi-Module/WizFi310/Programers-Guide/mqtt_example.md",sourceDirName:"Product/Wi-Fi-Module/WizFi310/Programers-Guide",slug:"/Product/Wi-Fi-Module/WizFi310/Programers-Guide/mqtt_example",permalink:"/Product/Wi-Fi-Module/WizFi310/Programers-Guide/mqtt_example",draft:!1,unlisted:!1,editUrl:"https://github.com/Wiznet/document_framework/tree/master/docs/Product/Wi-Fi-Module/WizFi310/Programers-Guide/mqtt_example.md",tags:[],version:"current",frontMatter:{id:"mqtt_example",title:"WizFi310 MQTT Example",date:"2020-04-15T00:00:00.000Z"},sidebar:"docs",previous:{title:"WizFi310 ThingPlug Example",permalink:"/Product/Wi-Fi-Module/WizFi310/Programers-Guide/thingplug_example"},next:{title:"Quick Start Guide",permalink:"/Product/Wi-Fi-Module/WizFi310/quick_start_guide"}},o={},c=[{value:"MQTT",id:"mqtt",level:2},{value:"How to use MQTT in WizFi310",id:"how-to-use-mqtt-in-wizfi310",level:2},{value:"MQTT AT Command Set",id:"mqtt-at-command-set",level:3},{value:"Example AT Command",id:"example-at-command",level:3},{value:"Connection",id:"connection",level:4},{value:"Subscribe &amp; Unsubscribe",id:"subscribe--unsubscribe",level:4},{value:"Publish",id:"publish",level:4},{value:"MQTT Example",id:"mqtt-example",level:2},{value:"Setup the Broker",id:"setup-the-broker",level:3},{value:"Make Topic",id:"make-topic",level:3},{value:"Connect to Adafruit Broker",id:"connect-to-adafruit-broker",level:3},{value:"Adafruit Username",id:"adafruit-username",level:4},{value:"Adafruit AIO Key",id:"adafruit-aio-key",level:4},{value:"Adafruit IP &amp; Port",id:"adafruit-ip--port",level:4},{value:"Publish the message",id:"publish-the-message",level:3},{value:"Display the message in io.adafruit.com",id:"display-the-message-in-ioadafruitcom",level:3}];function l(e){const i={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.h2,{id:"mqtt",children:"MQTT"}),"\n",(0,r.jsxs)(i.p,{children:['MQTT is a light weight messaging protocol for use on top of the TCP/IP\r\nprotocol. It is designed for connections with remote locations where a\r\n"small code footprint" is required or the network bandwidth is\r\nlimited.',(0,r.jsx)(i.br,{}),"\n","It is a communication protocol which almost can link all networked\r\nobjects with the external, and it is used as a sensor.",(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/MQTT",children:"Wikipedia"})]}),"\n",(0,r.jsx)(i.h2,{id:"how-to-use-mqtt-in-wizfi310",children:"How to use MQTT in WizFi310"}),"\n",(0,r.jsx)(i.h3,{id:"mqtt-at-command-set",children:"MQTT AT Command Set"}),"\n",(0,r.jsx)(i.p,{children:"There are the necessary Commands for MQTT protocol in the WizFi310."}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"AT+MQTTSET=<UserName>,<Password>,<ClientID>,<AliveTime>  \r\nAT+MQTTCON=<Con/Discon>,<BrokerIP>,<BrokerPort>,<SSL_Enable>  \r\nAT+MQTTSUB=<Sub/Unsub>,<Topic>  \r\nAT+MQTTPUB=<Topic>,<Length>  \n"})}),"\n",(0,r.jsxs)(i.p,{children:["You can find the detailed description about the AT Commands for MQTT\r\nat the link below.",(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.a,{href:"/Product/Wi-Fi-Module/WizFi310/Programers-Guide/at_commands#mqtt-commands",children:"AT Commands list for MQTT"})]}),"\n",(0,r.jsx)(i.h3,{id:"example-at-command",children:"Example AT Command"}),"\n",(0,r.jsx)(i.h4,{id:"connection",children:"Connection"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Connect to Broker with non SSL"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Already Joined AP.\r\n    \r\nAT+MQTTSET=wiznet,8df22daf1fc8427999953b796cdfb1df,wizfi310,60\r\n[OK]\r\nAT+MQTTCON=1,52.70.203.194,1883,0\r\n    \r\n[MQTT CONNECT]\r\n[OK]\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Connect to Broker with SSL"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Already Joined AP.\r\n    \r\nAT+MQTTSET=wiznet,8df22daf1fc8427999953b796cdfb1df,wizfi310_ssl,60\r\n[OK]\r\nAT+MQTTCON=1,52.70.203.194,8883,1\r\n    \r\n[MQTT CONNECT]\r\n[OK]\n"})}),"\n",(0,r.jsx)(i.h4,{id:"subscribe--unsubscribe",children:"Subscribe & Unsubscribe"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Subscribe & Receive Message"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Already Connected with MQTT broker.\r\n    \r\nAT+MQTTSUB=1,wiznet/f/WizFi310\r\n[OK]\r\n...\r\nwhen the message received.\r\n...\r\n{Q,wiznet/f/WizFi310,,9}test_data\n"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Unsubscribe"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Already Connected with MQTT broker.\r\n\r\nAT+MQTTSUB=0,wiznet/f/WizFi310\r\n[OK]\r\n\n"})}),"\n",(0,r.jsx)(i.h4,{id:"publish",children:"Publish"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"Already Connected with MQTT broker.\r\n\r\nAT+MQTTPUB=wiznet/f/WizFi310,3\r\n[3]\r\n...\r\nInput 3bytes to Serial interface.\r\n...\r\n[OK]\r\n\n"})}),"\n",(0,r.jsx)(i.hr,{}),"\n",(0,r.jsx)(i.h2,{id:"mqtt-example",children:"MQTT Example"}),"\n",(0,r.jsx)(i.h3,{id:"setup-the-broker",children:"Setup the Broker"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.a,{href:"https://io.adafruit.com/",children:"Adafruit"})," Broker would be used at this\r\nExample. Adafruit MQTT broker can support non SSL and SSL Connection and\r\nthe Adafruit shows the collected data as the Dashboard."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://learn.adafruit.com/adafruit-io/mqtt-api",children:"Adafruit MQTT API\r\nGuide"})}),"\n",(0,r.jsx)(i.h3,{id:"make-topic",children:"Make Topic"}),"\n",(0,r.jsxs)(i.p,{children:["Create the Feeds in Adafruit. it is equal to Topic in MQTT.",(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.img,{src:n(84402).Z+"",width:"1341",height:"413"}),"\r\n",(0,r.jsx)(i.img,{src:n(72425).Z+"",width:"1386",height:"447"}),(0,r.jsx)(i.br,{}),"\n","Then, You can see the graph that was made up of raw data.",(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.img,{src:n(17403).Z+"",width:"1333",height:"843"})]}),"\n",(0,r.jsx)(i.h3,{id:"connect-to-adafruit-broker",children:"Connect to Adafruit Broker"}),"\n",(0,r.jsx)(i.p,{children:"Before connection, you have to know the information below."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"Username"}),"\n",(0,r.jsx)(i.li,{children:"Adafruit AIO Key"}),"\n",(0,r.jsx)(i.li,{children:"Adafruit IP & Port"}),"\n"]}),"\n",(0,r.jsx)(i.h4,{id:"adafruit-username",children:"Adafruit Username"}),"\n",(0,r.jsx)(i.p,{children:"It is a username registered in Adafruit."}),"\n",(0,r.jsx)(i.h4,{id:"adafruit-aio-key",children:"Adafruit AIO Key"}),"\n",(0,r.jsxs)(i.p,{children:['It is an authentication key for connection to broker. It can be found in\r\n"VIEW AIO KEYS" button.',(0,r.jsx)(i.br,{}),"\n",(0,r.jsx)(i.img,{src:n(72232).Z+"",width:"1337",height:"517"})]}),"\n",(0,r.jsx)(i.h4,{id:"adafruit-ip--port",children:"Adafruit IP & Port"}),"\n",(0,r.jsx)(i.p,{children:"It is a information about Connection."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"You can see the IP address using ** AT+FDNS=io.adafruiot.com ** Command."}),"\n",(0,r.jsx)(i.li,{children:"non SSL Port is ** 1883 **, or SSL Port is ** 8883 **."}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"** There are AT Commands for setting up the WizFi310. That is used\r\nwhen using above information and non SSL connection. **"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"AT+FDNS=io.adafruit.com,3000\r\n52.70.203.194\r\n[OK]\r\nAT+MQTTSET=wiznet,8df22daf1fc8427999953b796cdfb1df,wiznet_1,60\r\n[OK]\r\nAT+MQTTCON=1,52.70.203.194,8883,1\r\n    \r\n[MQTT CONNECT]\r\n[OK]\n"})}),"\n",(0,r.jsxs)(i.p,{children:["** Client ID(wiznet_1) is identifier of each MQTT Client and it\r\nshould be unique per broker. **",(0,r.jsx)(i.br,{}),"\n","** KeepAlive time(60 seconds)**"]}),"\n",(0,r.jsx)(i.h3,{id:"publish-the-message",children:"Publish the message"}),"\n",(0,r.jsxs)(i.p,{children:["Adafruit IO's MQTT API exposes feed data using special topics. You can\r\npublish a new value for a feed to its topic, or you can subscribe to a\r\nfeed's topic to be notified when the feed has a new value. Any one of\r\nthe following topic forms is valid for a feed",(0,r.jsx)(i.br,{}),"\n","For Examples."]}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"wiznet/feeds/WizFi310"}),"\n",(0,r.jsx)(i.li,{children:"wiznet/f/WizFi310"}),"\n"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"AT+MQTTPUB=wiznet/f/WizFi310,4\r\n[4]\r\n...\r\nInput 4bytes to Serial interface.\r\n...\r\n[OK]\n"})}),"\n",(0,r.jsx)(i.p,{children:"** 2nd parameter of AT+MQTTPUB command is '4'. it means that you can publish the 4 byte. **"}),"\n",(0,r.jsx)(i.h3,{id:"display-the-message-in-ioadafruitcom",children:"Display the message in io.adafruit.com"}),"\n",(0,r.jsx)(i.p,{children:"You can see the published data in io.adafruit.com."}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{src:n(34349).Z+"",width:"1319",height:"869"})})]})}function h(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},84402:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/1_feeds-4e8af76b3d3851c9f2c3bf3ac360f114.png"},72425:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/2_newfeed-c1b43ad06581f4dcaec0d5611031b9cb.png"},17403:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/3_create_aio_key_1-6621660c16f141ad7d9f510567135cbc.png"},72232:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/4_create_aio_key_2-8823017364bfaedad82241943af97739.png"},34349:(e,i,n)=>{n.d(i,{Z:()=>r});const r=n.p+"assets/images/5_display_value-1e6c9d56edc60a2d4d351d8e2af02ef8.png"},11151:(e,i,n)=>{n.d(i,{Z:()=>a,a:()=>d});var r=n(67294);const t={},s=r.createContext(t);function d(e){const i=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(s.Provider,{value:i},e.children)}}}]);