<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="search" type="application/opensearchdescription+xml" title="WIZnet Document System" href="/opensearch.xml"><title data-react-helmet="true">BLE to Ethernet | WIZnet Document System</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://docs.wiznet.io/VAR-Products-using-WIZnet/ble_to_ethernet"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="BLE to Ethernet | WIZnet Document System"><meta data-react-helmet="true" name="description" content="Using WIZnet TCP/IP Ethernet chip W5500 and the Nordic BLE SoC nRF52832"><meta data-react-helmet="true" property="og:description" content="Using WIZnet TCP/IP Ethernet chip W5500 and the Nordic BLE SoC nRF52832"><link data-react-helmet="true" rel="shortcut icon" href="/img/wizfavicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.wiznet.io/VAR-Products-using-WIZnet/ble_to_ethernet"><link data-react-helmet="true" rel="alternate" href="https://docs.wiznet.io/VAR-Products-using-WIZnet/ble_to_ethernet" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.wiznet.io/VAR-Products-using-WIZnet/ble_to_ethernet" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.be153ebf.css">
<link rel="preload" href="/assets/js/runtime~main.ad77bd1e.js" as="script">
<link rel="preload" href="/assets/js/main.6509c52d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" style="background-color:#C51A4A;color:#fafbfc" role="banner"><div class="announcementBarContent_3EUC">‚≠êÔ∏è Meet our new product: <a target="" rel="noopener noreferrer" href="/Product/Open-Source-Hardware/wiznet_ethernet_hat">WIZnet Ethernet HAT for Raspberry Pi Pico</a> ‚≠êÔ∏è</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/wiznet_logo.svg" alt="Wiznet Company Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/wiznet_logo-white.svg" alt="Wiznet Company Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Documents</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/introduction">Introduction ‚û§</a></li><li><a class="dropdown__link" href="/Design-Guide/design_guide">Design Guide ‚û§</a></li><li><a class="dropdown__link" href="/VAR-Products-using-WIZnet/var_products_using_wiznet">VAR Products ‚û§</a></li></ul></div><a href="https://forum.wiznet.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.wiznet.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>WIZnet<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">‚õà</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">üå§</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Products</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Design Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">VAR Products using WIZnet</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/VAR-Products-using-WIZnet/var_products_using_wiznet">VAR Products using WIZnet</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/VAR-Products-using-WIZnet/ethernet_shield">Ethernet Shield</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/VAR-Products-using-WIZnet/wi_fi_shield">Wi-Fi Shield</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/VAR-Products-using-WIZnet/ble_to_ethernet">BLE to Ethernet</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/VAR-Products-using-WIZnet/w5500BoB_ESoPe">W5500BoB (ESoPe)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/VAR-Products-using-WIZnet/w5500CoB_ESoPe">W5500CoB (ESoPe)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/VAR-Products-using-WIZnet/third_party">Third party</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_1CGd"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_3E-R"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>BLE to Ethernet</h1></header><p>Using WIZnet TCP/IP Ethernet chip W5500 and the Nordic BLE SoC nRF52832
implemented the BLE to Ethernet. BLE Central/Peripheral communicate
using a UART Nordic Service (NUS) Profile. And BLE Central and W5500
communicate with SPI. W5500 also operates as a TCP Client, TCP Server to
communicate with the LAN (through the line). The purpose of this
Application Note is to build a low power IoT node environment.</p><p><img src="/assets/images/1-1_bte_introduce-a3e2fae751e81c82641299a82aa082eb.jpg"></p><p><img src="/assets/images/ble_to_tcp_article_5-6f9b4e28be388e60078d79e90eccd301.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="development-environment"></a>Development Environment<a class="hash-link" href="#development-environment" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="firmware"></a>Firmware<a class="hash-link" href="#firmware" title="Direct link to heading">#</a></h3><p>üåé<a href="https://github.com/Wiznet/WIZBLE510_ETHERNET" target="_blank" rel="noopener noreferrer">https://github.com/Wiznet/WIZBLE510_ETHERNET</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="hardware"></a>Hardware<a class="hash-link" href="#hardware" title="Direct link to heading">#</a></h3><table><thead><tr><th>Product</th><th>DataSheet Download link</th></tr></thead><tbody><tr><td>nRF52832</td><td><a href="http://infocenter.nordicsemi.com/pdf/nRF52832_PS_v1.0.pdf" target="_blank" rel="noopener noreferrer">Download</a></td></tr><tr><td>PCA10040</td><td><a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.nrf52/dita/nrf52/development/nrf52_dev_kit.html?cp=2_0" target="_blank" rel="noopener noreferrer">Download</a></td></tr><tr><td>W5500</td><td><a href="/Product/iEthernet/W5500/datasheet">Download</a></td></tr><tr><td>Schematic</td><td><a href="https://drive.google.com/open?id=0Bx-BD_H8XJXxVWdrcVliY1E1RGM" target="_blank" rel="noopener noreferrer">Download</a></td></tr><tr><td>Altium</td><td><a href="https://drive.google.com/open?id=0Bx-BD_H8XJXxek13TlBubXZZclE" target="_blank" rel="noopener noreferrer">Download</a></td></tr><tr><td>Gerber</td><td><a href="https://drive.google.com/open?id=0Bx-BD_H8XJXxWmg0MDlnWVJLZ2M" target="_blank" rel="noopener noreferrer">Download</a></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="pc-tools"></a>PC Tools<a class="hash-link" href="#pc-tools" title="Direct link to heading">#</a></h3><table><thead><tr><th>PC Tools</th><th>Download link</th></tr></thead><tbody><tr><td>Keil MDK 5.17</td><td><a href="https://www.keil.com/demo/eval/arm.htm" target="_blank" rel="noopener noreferrer">Download</a></td></tr><tr><td>nRFgo Studio</td><td><a href="https://www.nordicsemi.com/eng/Products/2.4GHz-RF/nRFgo-Studio#Downloads" target="_blank" rel="noopener noreferrer">Download</a></td></tr><tr><td>Hercules</td><td><a href="http://hercules-setup.soft32.com/" target="_blank" rel="noopener noreferrer">Download</a></td></tr></tbody></table><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="base-protocol"></a>Base Protocol<a class="hash-link" href="#base-protocol" title="Direct link to heading">#</a></h2><p>The project made use of TCP and BLE NUS Service. Each document is on the
link below.</p><table><thead><tr><th>Protocol</th><th>Document</th></tr></thead><tbody><tr><td>W5500 TCP</td><td><a href="/Product/iEthernet/W5500/Application/tcp">Doc Link</a></td></tr><tr><td>BLE NUS Central</td><td><a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v11.0.0/ble_sdk_app_nus_c.html?cp=5_0_0_4_2_0_3" target="_blank" rel="noopener noreferrer">Doc Link</a></td></tr><tr><td>BLE NUS Peripheral</td><td><a href="http://infocenter.nordicsemi.com/topic/com.nordic.infocenter.sdk5.v11.0.0/ble_sdk_app_nus_eval.html?cp=5_0_0_4_2_2_18" target="_blank" rel="noopener noreferrer">Doc Link</a></td></tr></tbody></table><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="code-configuration"></a>Code configuration<a class="hash-link" href="#code-configuration" title="Direct link to heading">#</a></h2><p><img src="/assets/images/2_bte_codeconfiguration-1899e539093185cb622837039fca9d6e.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="uart_init"></a>uart_init<a class="hash-link" href="#uart_init" title="Direct link to heading">#</a></h3><p>UART Initializes for communication with a PC. The pins can be changed
freely.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">uart_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">app_uart_event_handler_t</span><span class="token plain"> event_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">app_irq_priority_t</span><span class="token plain"> irq_priority</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain"> err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">app_uart_comm_params_t</span><span class="token plain"> comm_params </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rx_pin_no    </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> RX_PIN_NUMBER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">tx_pin_no    </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> TX_PIN_NUMBER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rts_pin_no   </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">cts_pin_no   </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0xFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">flow_control </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> APP_UART_FLOW_CONTROL_DISABLED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">use_parity   </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">baud_rate    </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> UART_BAUDRATE_BAUDRATE_Baud115200</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_UART_FIFO_INIT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">comm_params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        UART_RX_BUF_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        UART_TX_BUF_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        event_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        irq_priority</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ble_stack_init"></a>ble_stack_init<a class="hash-link" href="#ble_stack_init" title="Direct link to heading">#</a></h3><p>Initialize BLE stack and RTC clock.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ble_stack_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain"> err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">nrf_clock_lf_cfg_t</span><span class="token plain"> clock_lf_cfg </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> NRF_CLOCK_LFCLKSRC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Initialize the SoftDevice handler module.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">SOFTDEVICE_HANDLER_INIT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">clock_lf_cfg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ble_enable_params_t</span><span class="token plain"> ble_enable_params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">softdevice_enable_get_default_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CENTRAL_LINK_COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                    PERIPHERAL_LINK_COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                    </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">ble_enable_params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Check the ram settings against the used number of links</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">CHECK_RAM_START_ADDR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CENTRAL_LINK_COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">PERIPHERAL_LINK_COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Enable BLE stack.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">softdevice_enable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">ble_enable_params</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Register with the SoftDevice handler module for BLE events.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">softdevice_ble_evt_handler_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ble_evt_dispatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="nus_c_init"></a>nus_c_init<a class="hash-link" href="#nus_c_init" title="Direct link to heading">#</a></h3><p>Initializes function that the NUS central service.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">nus_c_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ble_nus_c_evt_handler_t</span><span class="token plain"> evt_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain">         err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ble_nus_c_init_t</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">nus_c_init_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">nus_c_init_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">evt_handler </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> evt_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ble_nus_c_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token class-name" style="color:rgb(255, 203, 107)">nus_c_init_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sd_ble_gap_address_get</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">own_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="db_discovery_init"></a>db_discovery_init<a class="hash-link" href="#db_discovery_init" title="Direct link to heading">#</a></h3><p>initializes database discovery.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">db_discovery_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain"> err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ble_db_discovery_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db_disc_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="spi0_master_init"></a>spi0_master_init<a class="hash-link" href="#spi0_master_init" title="Direct link to heading">#</a></h3><p>initialize W5500 and SPI communication function. Pins can be changed
freely.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">spi0_master_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SPIConfig_t spi_info </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Fields</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">BitOrder </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPI_BITORDER_MSB_LSB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Fields</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Mode     </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPI_MODE3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Frequency              </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPI_FREQ_8MBPS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Pin_SCK                </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPIM0_SCK_PIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Pin_MOSI               </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPIM0_MOSI_PIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Pin_MISO               </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPIM0_MISO_PIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Pin_CSN                </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SPIM0_SS_PIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">spi_master_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SPI0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">spi_info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="user_ethernet_init"></a>user_ethernet_init<a class="hash-link" href="#user_ethernet_init" title="Direct link to heading">#</a></h3><p>Function that initializes the W5500 through SPI.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">user_ethernet_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> memsize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    wiz_NetTimeout timeout_info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">reg_wizchip_cs_cbfunc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">wizchip_select</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> wizchip_deselect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">reg_wizchip_spi_cbfunc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">wizchip_read</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> wizchip_write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* WIZCHIP SOCKET Buffer initialize */</span><span class="token plain">  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;W5500 memory init\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">ctlwizchip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CW_INIT_WIZCHIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">memsize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;WIZCHIP Initialized fail.\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* PHY link status check */</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;W5500 PHY Link Status Check\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">ctlwizchip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">CW_GET_PHYLINK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">tmp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Unknown PHY Link stauts.\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tmp </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> PHY_LINK_OFF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout_info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">retry_cnt </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeout_info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">time_100us </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x3E8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// timeout value = 10ms</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">wizchip_settimeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">timeout_info</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Network initialization */</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">network_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="user_app_timer_init"></a>user_app_timer_init<a class="hash-link" href="#user_app_timer_init" title="Direct link to heading">#</a></h3><p>App Timer Task registration and period setting.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">user_app_timer_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain"> err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">app_timer_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">tcp_con_timer_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> APP_TIMER_MODE_REPEATED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tcp_con_timer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">app_timer_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">ble_to_tcps_timer_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> APP_TIMER_MODE_REPEATED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ble_to_tcps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">app_timer_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">tcps_to_ble_timer_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> APP_TIMER_MODE_REPEATED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tcps_to_ble</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="user_app_timer_start"></a>user_app_timer_start<a class="hash-link" href="#user_app_timer_start" title="Direct link to heading">#</a></h3><p>App_timer Task Start</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">user_app_timer_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain"> err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">app_timer_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tcp_con_timer_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TCP_CON_INTERVAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">app_timer_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ble_to_tcps_timer_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> BLE_TO_TCPS_INTERVAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">app_timer_start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tcps_to_ble_timer_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TCPS_TO_BLE_INTERVAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="tcp_con_timer"></a>tcp_con_timer<a class="hash-link" href="#tcp_con_timer" title="Direct link to heading">#</a></h3><p>A connection with the TCP Server and checks periodically connected. It
tries to reconnect when disconnected.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tcp_con_timer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> p_context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">int32_t</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// return value for SOCK_ERRORs</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Port number for TCP client (will be increased)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint16_t</span><span class="token plain"> any_port </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Socket Status Transitions</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Check the W5500 Socket n status register (Sn_SR, The &#x27;Sn_SR&#x27; controlled by Sn_CR command or Packet send/recv status)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">switch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">getSn_SR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> SOCK_CLOSE_WAIT </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifdef</span><span class="token macro property"> </span><span class="token macro property expression">_LOOPBACK_DEBUG_</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//printf(&quot;%d:CloseWait\r\n&quot;,sn);</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">disconnect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SOCK_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d:Socket Closed Fail\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifdef</span><span class="token macro property"> </span><span class="token macro property expression">_LOOPBACK_DEBUG_</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d:Socket Closed\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> SOCK_INIT </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifdef</span><span class="token macro property"> </span><span class="token macro property expression">_LOOPBACK_DEBUG_</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d:Try to connect to the %d.%d.%d.%d : %d\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> targetIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> targetIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> targetIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> targetIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">tcp_targetPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">connect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> targetIP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> tcp_targetPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SOCK_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d:Socket Connect Fail\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Try to TCP connect to the TCP server (destination)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> SOCK_CLOSED</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token function" style="color:rgb(130, 170, 255)">socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> Sn_MR_TCP</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> any_port</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0x00</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d:Socket Open Fail\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TCP socket open with &#x27;any_port&#x27; port number</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">              </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">default</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="tcps_to_ble"></a>tcps_to_ble<a class="hash-link" href="#tcps_to_ble" title="Direct link to heading">#</a></h3><p>Data from the TCP Server delivers on the BLE Peripheral.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">tcps_to_ble</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> p_context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> k</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">int32_t</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">DATA_BUF_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getSn_RX_RSR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Sn_RX_RSR: Socket n Received Size Register, Receiving data length</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        size </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> DATA_BUF_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// DATA_BUF_SIZE means user defined buffer size (array)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">recv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Data Receive process (H/W Rx socket buffer -&gt; User&#x27;s buffer)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// socket close</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">while</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> BLE_NUS_MAX_DATA_LEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">ble_nus_c_string_send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">buf</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain">k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> NRF_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// repeat until sent.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                size</span><span class="token operator" style="color:rgb(137, 221, 255)">-=</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                k</span><span class="token operator" style="color:rgb(137, 221, 255)">+=</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ble_to_tcps"></a>ble_to_tcps<a class="hash-link" href="#ble_to_tcps" title="Direct link to heading">#</a></h3><p>Data from the BLE Peripheral delivers on the TCP Server.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ble_to_tcps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> p_context</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">int32_t</span><span class="token plain"> ret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data_in_flag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">getSn_SR</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> SOCK_ESTABLISHED</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">sprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;[From BLE_P] %02x:%02x:%02x:%02x:%02x:%02x &quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">peer_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">peer_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">peer_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">peer_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">peer_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">peer_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">strlen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    ret </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">ble_input_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ble_input_data_len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ret </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Send Error occurred (sent data length &lt; 0)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        </span><span class="token function" style="color:rgb(130, 170, 255)">close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">SOCK_TCPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// socket close</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    data_in_flag </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ble_nus_c_evt_handler"></a>ble_nus_c_evt_handler<a class="hash-link" href="#ble_nus_c_evt_handler" title="Direct link to heading">#</a></h3><p>Interrupt is occurred by data that comes from BLE Peripheral. Data from
BLE Peripheral stores on the ble_input_data buffer.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">nus_c_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">ble_nus_c_evt_handler_t</span><span class="token plain"> evt_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint32_t</span><span class="token plain">         err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">ble_nus_c_init_t</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">nus_c_init_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">nus_c_init_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">evt_handler </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> evt_handler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">ble_nus_c_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token class-name" style="color:rgb(255, 203, 107)">nus_c_init_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    err_code </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sd_ble_gap_address_get</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">own_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">err_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="uart_event_handle"></a>uart_event_handle<a class="hash-link" href="#uart_event_handle" title="Direct link to heading">#</a></h3><p>The Interrupt occurs when UART Data Input. And it sends it to UART Input
Data in BLE Peripheral.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly c"><pre tabindex="0" class="prism-code language-c codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">uart_event_handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token class-name" style="color:rgb(255, 203, 107)">app_uart_evt_t</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> p_event</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> data_array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">BLE_NUS_MAX_DATA_LEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">static</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">uint8_t</span><span class="token plain"> index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p_event</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">evt_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**@snippet [Handling data from UART] */</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> APP_UART_DATA_READY</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">UNUSED_VARIABLE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">app_uart_get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">data_array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            index</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data_array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">index </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">index </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">BLE_NUS_MAX_DATA_LEN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">ble_nus_c_string_send</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">user_m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">m_ble_nus_c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> data_array</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> NRF_SUCCESS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// repeat until sent.</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                index </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**@snippet [Handling data from UART] */</span><span class="token plain"> </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> APP_UART_COMMUNICATION_ERROR</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_HANDLER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p_event</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">error_communication</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> APP_UART_FIFO_ERROR</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">APP_ERROR_HANDLER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p_event</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">error_code</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">default</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">break</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="hw-setting"></a>H/W Setting<a class="hash-link" href="#hw-setting" title="Direct link to heading">#</a></h3><p><img src="/assets/images/ble_to_tcp_hw_settingpng-0cfc83e79705362ceca0bca187ee3c32.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ble-stack-softdevice-writing"></a>BLE Stack (SoftDevice) Writing<a class="hash-link" href="#ble-stack-softdevice-writing" title="Direct link to heading">#</a></h3><p>Program the S132_nrf52_2.0.1_softdevice.hex attached to
nRF5_SDK_11.0.0_W5500_ble-to-ethernet.zip on two boards. (Ble to
Ethernet Board, PCA10040)</p><p><img src="/assets/images/3-1_bte_testing-4ada528be0842b35b36834c150656fe4.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ble-to-ethernet-board-application-writing"></a>Ble to ethernet Board application Writing<a class="hash-link" href="#ble-to-ethernet-board-application-writing" title="Direct link to heading">#</a></h3><p>Open the
nRF5_SDK_11.0.0_W5500_ble-to-ethernet\examples\ble_central\ble_uart_c_to_tcpc\pca10040\s132\arm5_no_packs
path of the project. Put the IP Address of the TCP server PC to the 60th
line of the variable targetIP main.c, build, and Program a ble to
ethernet board.</p><p><img src="/assets/images/ipconfig-8b84bcd3d72be00a9737f9b669b77669.png"></p><p><img src="data:image/jpeg;base64,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"></p><p><img src="/assets/images/3-4_bte_testing-89dbed8beb3ed3fc1ee39f26d87153c8.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="pca10040-application-writing"></a>PCA10040 application Writing<a class="hash-link" href="#pca10040-application-writing" title="Direct link to heading">#</a></h3><p>Build the project to open a path
nRF5_SDK_11.0.0_89a8197\examples\ble_peripheral\ble_app_uart\pca10040\s132\arm5_no_packs,
and Writing in PCA10040 board.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="config-hyperterminal--tcp-server"></a>Config HyperTerminal &amp; TCP Server<a class="hash-link" href="#config-hyperterminal--tcp-server" title="Direct link to heading">#</a></h3><p>Three open the Hercules. Two Hercules is set to 115200 baud rate in the
Serial Tab and open the Com port. One of the Hercules Port is set to
5000 in the TCP Server tab and click on the listen.</p><p><img src="/assets/images/3-5_bte_testing-46789ea9e27f086564f584ec67108197.jpg"></p><p><img src="/assets/images/3-6_bte_testing-4812631c57da332490674d7dfd45ec43.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="data-input"></a>Data Input<a class="hash-link" href="#data-input" title="Direct link to heading">#</a></h3><p>Input from the WIZNET PCA10040 Terminal can see that is sent to the TCP
Server.</p><p><img src="/assets/images/3-7_bte_testing-799319b2564149eca448c6c40e2a8e69.jpg"></p><p><img src="/assets/images/3-8_bte_testing-78bdc2eee28e6845cf876210d4bb1d1f.jpg"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Wiznet/document_framework/tree/master/docs/VAR-Products-using-WIZnet/bletoethernet.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/VAR-Products-using-WIZnet/wi_fi_shield"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Wi-Fi Shield</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/VAR-Products-using-WIZnet/w5500BoB_ESoPe"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">W5500BoB (ESoPe) ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#development-environment" class="table-of-contents__link">Development Environment</a><ul><li><a href="#firmware" class="table-of-contents__link">Firmware</a></li><li><a href="#hardware" class="table-of-contents__link">Hardware</a></li><li><a href="#pc-tools" class="table-of-contents__link">PC Tools</a></li></ul></li><li><a href="#base-protocol" class="table-of-contents__link">Base Protocol</a></li><li><a href="#code-configuration" class="table-of-contents__link">Code configuration</a><ul><li><a href="#uart_init" class="table-of-contents__link">uart_init</a></li><li><a href="#ble_stack_init" class="table-of-contents__link">ble_stack_init</a></li><li><a href="#nus_c_init" class="table-of-contents__link">nus_c_init</a></li><li><a href="#db_discovery_init" class="table-of-contents__link">db_discovery_init</a></li><li><a href="#spi0_master_init" class="table-of-contents__link">spi0_master_init</a></li><li><a href="#user_ethernet_init" class="table-of-contents__link">user_ethernet_init</a></li><li><a href="#user_app_timer_init" class="table-of-contents__link">user_app_timer_init</a></li><li><a href="#user_app_timer_start" class="table-of-contents__link">user_app_timer_start</a></li><li><a href="#tcp_con_timer" class="table-of-contents__link">tcp_con_timer</a></li><li><a href="#tcps_to_ble" class="table-of-contents__link">tcps_to_ble</a></li><li><a href="#ble_to_tcps" class="table-of-contents__link">ble_to_tcps</a></li><li><a href="#ble_nus_c_evt_handler" class="table-of-contents__link">ble_nus_c_evt_handler</a></li><li><a href="#uart_event_handle" class="table-of-contents__link">uart_event_handle</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#hw-setting" class="table-of-contents__link">H/W Setting</a></li><li><a href="#ble-stack-softdevice-writing" class="table-of-contents__link">BLE Stack (SoftDevice) Writing</a></li><li><a href="#ble-to-ethernet-board-application-writing" class="table-of-contents__link">Ble to ethernet Board application Writing</a></li><li><a href="#pca10040-application-writing" class="table-of-contents__link">PCA10040 application Writing</a></li><li><a href="#config-hyperterminal--tcp-server" class="table-of-contents__link">Config HyperTerminal &amp; TCP Server</a></li><li><a href="#data-input" class="table-of-contents__link">Data Input</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/introduction">Introduction</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forum.wiznet.io" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>WIZnet Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="http://maker.wiznet.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>WIZnet Maker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/Wiznet/document_framework" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2021 WIZnet Co., Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ad77bd1e.js"></script>
<script src="/assets/js/main.6509c52d.js"></script>
</body>
</html>