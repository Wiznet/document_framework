(window.webpackJsonp=window.webpackJsonp||[]).push([[338],{394:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return b})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(6),i=(n(0),n(582)),c={id:"tinygecko",title:"Tiny Gecko",date:new Date("2020-04-03T00:00:00.000Z")},l={unversionedId:"Product/Open-Source-Hardware/tinygecko",id:"Product/Open-Source-Hardware/tinygecko",isDocsHomePage:!1,title:"Tiny Gecko",description:"Tiny GECKO Starter Kit STK3300 is a prototyping and application",source:"@site/docs\\Product\\Open-Source-Hardware\\tinygecko.md",permalink:"/docs/Product/Open-Source-Hardware/tinygecko",editUrl:"https://github.com/Wiznet/document_framework/tree/master/docs/Product/Open-Source-Hardware/tinygecko.md",sidebar:"docs",previous:{title:"Energy Micro",permalink:"/docs/Product/Open-Source-Hardware/Energy_micro"},next:{title:"Twitter Test",permalink:"/docs/Product/Open-Source-Hardware/twitter_test"}},b=[{value:"Preparation for adding W5500",id:"preparation-for-adding-w5500",children:[]},{value:"How to connect W5500(WIZ550io)",id:"how-to-connect-w5500wiz550io",children:[]},{value:"Quick Start",id:"quick-start",children:[]},{value:"How to Test",id:"how-to-test",children:[]},{value:"Loopback",id:"loopback",children:[]},{value:"DHCP",id:"dhcp",children:[]},{value:"DNS",id:"dns",children:[]}],o={rightToc:b};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},o,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Tiny GECKO Starter Kit STK3300 is a prototyping and application\ndevelopment tool for the EFM32TG MCU family with the ARM Cortex-M3 CPU\ncore. We use EMF32TG840F32 in EFM32TG family. Its SPEC is as follows."),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/osh/energymicro/tg840_spec.png",alt:null}))),Object(i.b)("h4",{id:"features"},"Features"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Advanced Energy Monitoring system for precise current tracking."),Object(i.b)("li",{parentName:"ul"},"Special hardware configuration for isolation of the MCU power\ndomain."),Object(i.b)("li",{parentName:"ul"},"Full feature USB debugger with debug out functionality."),Object(i.b)("li",{parentName:"ul"},"160 segment Energy Micro LCD."),Object(i.b)("li",{parentName:"ul"},Object(i.b)("strong",{parentName:"li"},"20 pin expansion header"),". \\<- // To be used for interfacing\nwith W5500(WIZ550io) //"),Object(i.b)("li",{parentName:"ul"},"Breakout pads for easy access to I/O pins."),Object(i.b)("li",{parentName:"ul"},"Powered by USB or CR2032 battery."),Object(i.b)("li",{parentName:"ul"},"2 user buttons, 1 user LED and a touch slider."),Object(i.b)("li",{parentName:"ul"},"Ambient Light sensor and inductive-capacitive metal sensor."),Object(i.b)("li",{parentName:"ul"},"EFM32 Op-amp footprint."),Object(i.b)("li",{parentName:"ul"},"32MHz and 32.768kHz crystal oscillators.")),Object(i.b)("h4",{id:"hardware-layout"},"Hardware Layout"),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/osh/energymicro/tinygecko_hw_layout.png",alt:null}))),Object(i.b)("hr",null),Object(i.b)("h2",{id:"preparation-for-adding-w5500"},"Preparation for adding W5500"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"../..ioModule/WIZ550io/overview"}),"WIZ550io")," or ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"oshield_a"}),"ioShileds")),Object(i.b)("li",{parentName:"ul"},"Tiny Gecko Starter Kit")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"http://www.iar.com/"}),"IAR Embedded Workbench for ARM")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"http://www.silabs.com/products/mcu/Pages/simplicity-studio.aspx"}),"Simplicity\nStudio"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Energy Micro Library : emlib"),Object(i.b)("li",{parentName:"ul"},"Application notes & example"),Object(i.b)("li",{parentName:"ul"},"Documents")))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"../../iMCU/W5500/driver"}),"Download the latest ioLibrary BSD"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Ethernet"),Object(i.b)("li",{parentName:"ul"},"Internet ")))),Object(i.b)("hr",null),Object(i.b)("h2",{id:"how-to-connect-w5500wiz550io"},"How to connect W5500(WIZ550io)"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null})),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"TinyGecko 20Pins EXP Header (TG840F032)"),Object(i.b)("th",Object(a.a)({parentName:"tr"},{align:null}),"W5500 (WIZ550io)"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"MOSI"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","4 (PD0)"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","34 (J1:3)")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"MISO"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","6 (PD1)"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","35 (J1:4)")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"SCLK"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","8 (PD2)"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","33 (J1:5)")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"SCS"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","10 (PD3)"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","32 (J1:6)")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"UART TX"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","12 (PD4)"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Yours")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"UART RX"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"#","14 (PD5)"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Yours")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"Power"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"3.3V/VMCU/5V & GND"),Object(i.b)("td",Object(a.a)({parentName:"tr"},{align:null}),"VDD & GND(J1:7-8/J2:1 & J1:1-2/J2:6)")))),Object(i.b)("p",null,Object(i.b)("img",Object(a.a)({parentName:"p"},{src:"/img/osh/energymicro/tg840_wiz550io.jpg",alt:null}))),Object(i.b)("hr",null),Object(i.b)("h2",{id:"quick-start"},"Quick Start"),Object(i.b)("h4",{id:"download-iar-project-for-example-loopbackdhcpdns"},"Download IAR project for example (Loopback/DHCP/DNS)"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{href:"/img/osh/energymicro/efm32tg840f32_w5500_20131220.zip",target:"_blank"},"efm32tg840f32\\_w5500\\_20131220.zip")),Object(i.b)("li",{parentName:"ul"},"Extract the downloaded zip file on your PC.")),Object(i.b)("h4",{id:"install-the-latest-iolibrary-bsd"},"Install the latest ioLibrary BSD"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Project's ioLibrary is ",Object(i.b)("strong",{parentName:"li"},"empty"))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Install ioLibrary",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Copy the previous downloaded ioLibrary","_","bsd ","[","Ethernet","]"," into\n","[","ioLibrary","]"),Object(i.b)("li",{parentName:"ul"},"Copy the previous downloaded ioLibrary","_","bsd ","[","Internet","]"," into\n","[","ioLibrary","]"),Object(i.b)("li",{parentName:"ul"},Object(i.b)("img",Object(a.a)({parentName:"li"},{src:"/img/osh/energymicro/iar_project_directory.png",alt:null})))))),Object(i.b)("h4",{id:"open-project--make-image"},"Open Project & Make image"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Using IAR Embedded Workbench for ARM"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Open ",Object(i.b)("strong",{parentName:"li"},"LoopbackTest.eww(DHCPTest.eww,DNSTest.eww)")," in the\nproject's ","[","iar","]"," directory."),Object(i.b)("li",{parentName:"ul"},"Make the executable image (.bin or .out)"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("em",{parentName:"p"},"For more detail, refer to Tools manual provided IAR.")),Object(i.b)("p",{parentName:"li"},"  If You want to monitor the progressing or debugging message of the project on your Terminal program,\nDownload the image in ","[iar>>Debug>>Exe]",". "))),Object(i.b)("h4",{id:"programdownload-the-executable-image-thru-usb-j-link"},"Program(download) the executable image thru USB J-Link"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Using IAR Embedded Workbench for ARM"),Object(i.b)("li",{parentName:"ul"},"Using AwareEnergy Commander of Simplicity Stdio "),Object(i.b)("li",{parentName:"ul"},Object(i.b)("em",{parentName:"li"},"For more detail, Refer to Tools manual provided IAR or SiLab."))),Object(i.b)("hr",null),Object(i.b)("h2",{id:"how-to-test"},"How to Test"),Object(i.b)("h4",{id:"tiny-gecko-config"},"Tiny Gecko Config"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"HFCORECLOCK : 32MHz"),Object(i.b)("li",{parentName:"ul"},"HFPERCLCOK : 32MHz"),Object(i.b)("li",{parentName:"ul"},"LEUART0 : 32.768KHz",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Baud rate : 14400 (8-N-1)"))),Object(i.b)("li",{parentName:"ul"},"USART0 : 8MHz (// Doesn't work well on 16MHz. Maybe connected by\nnoisy wire-jumper-line.//)",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"For SPI interface with W5500(WIZ550io)")))),Object(i.b)("h4",{id:"monitor--debug"},"Monitor & Debug"),Object(i.b)("p",null,"Define ",Object(i.b)("strong",{parentName:"p"},"DEBUG","_","MODE")," with one among ",Object(i.b)("em",{parentName:"p"},"DEBUG","_","SWO")," and ",Object(i.b)("em",{parentName:"p"},"DEBUG","_","LEUART"),"\nin ","[","src",">",">","bsp","_","tg840.h","]"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"   /* DEBUG MODE */\n   #define DEBUG_NO        0\n   #define DEBUG_SWO       1\n   #define DEBUG_LEUART    2\n\n   #if defined(NDEBUG)    //<- NDEBUG is defined by IAR tool in making release image.\n      #define DEBUG_MODE      DEBUG_NO\n   #else\n      #include <stdio.h>\n      #define DEBUG_MODE      DEBUG_SWO    //<- For using IAR's Terminal IO window.\n    //#define DEBUG_MODE      DEBUG_LEUART //<- For Your serail Terminal program\n   #endif\n")),Object(i.b)("h4",{id:"allocate-memory-for-internet-data"},"Allocate Memory for Internet Data"),Object(i.b)("p",null,"You can adjust the memory size for Internet data in\n","[","src",">",">","bsp","_","tg840.h","]","."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"/* MAX DATA BUFFER SIZE */\n#define DATA_BUF_SIZE   2048    // It is depend on Target System Memory\n")),Object(i.b)("hr",null),Object(i.b)("h2",{id:"loopback"},"Loopback"),Object(i.b)("p",null,"The loopback example runs with a TCP session and a UDP session."),Object(i.b)("p",null,"First, Board and your PC should have the network config with the same\nnetwork range.",Object(i.b)("br",{parentName:"p"}),"\n","If you want to modify board-side, edit the following code in\n","[","src",">",">","LB","_","main.c","]"," with the same range which your PC has. If you want\nto modify your PC-side, refer to ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/osh/cookie/ip_conf_b"}),"IP\nconfiguration"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-cpp"}),"wiz_NetInfo gWIZNETINFO = { .mac = {0x00, 0x08, 0xdc,0x00, 0xab, 0xcd}, //<-mac should be unique.\n                            .ip = {192, 168, 1, 123},\n                            .sn = {255,255,255,0},\n                            .gw = {192, 168, 1, 1},\n                            .dns = {0,0,0,0},\n                            .dhcp = NETINFO_STATIC };\n")),Object(i.b)("h4",{id:"tcp"},"TCP"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Connect to Board ",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Using ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"/osh/cookie/loopback_test"}),"Hercules test program")," or\nothers, try to connect to board with xxx.xxx.xxx.xxx listen port\n5000."))),Object(i.b)("li",{parentName:"ol"},"When connected",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"send data to board "),Object(i.b)("li",{parentName:"ul"},"check whether the loopback data is same to what it sent before."))),Object(i.b)("li",{parentName:"ol"},"When failed to connect",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Check link status."),Object(i.b)("li",{parentName:"ul"},"Check ping test"),Object(i.b)("li",{parentName:"ul"},"Check network config."),Object(i.b)("li",{parentName:"ul"},"Check the security program as virus vaccines and fire-wall on\nyour PC. ")))),Object(i.b)("h4",{id:"udp"},"UDP"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Send data",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Using ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"/osh/cookie/loopback_test"}),"Hercules test program")," or\nothers, send to board's xxx.xxx.xxx.xxx port 3000."))),Object(i.b)("li",{parentName:"ol"},"When success",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"check to the loopback data"))),Object(i.b)("li",{parentName:"ol"},"When fail ",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Check link status."),Object(i.b)("li",{parentName:"ul"},"Check ping test"),Object(i.b)("li",{parentName:"ul"},"Check network config."),Object(i.b)("li",{parentName:"ul"},"Check the security program as virus vaccines and fire-wall on\nyour PC. ")))),Object(i.b)("hr",null),Object(i.b)("h2",{id:"dhcp"},"DHCP"),Object(i.b)("p",null,"DHCP example runs with one UDP socket. If you want the Dynamic IP\ninstead of static, Apply it."),Object(i.b)("p",null,"To test the example,"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"First ready to DHCP server to run on the LAN belongs to the board."),Object(i.b)("li",{parentName:"ul"},"SHOULD BE set the ",Object(i.b)("strong",{parentName:"li"},"unique")," MAC address to W5500's SHAR register\nbefore ",Object(i.b)("em",{parentName:"li"},"DHCP","_","init()")," call.")),Object(i.b)("p",null,"If you want to monitor or display message of DHCP processing, Define\nDEBUG","_","MODE in bsp","_","tg840.h (refer to the above description ",Object(i.b)("em",{parentName:"p"},'"How to\ntest',">",">",'Monitor & Debug"'),".) and Define ",Object(i.b)("strong",{parentName:"p"},"_","DHCP","_","DEBUG","_")," in\n","[","ioLibrary",">",">","Internet",">",">","DHCP",">",">","dhcp.h","]","."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"/*\n * @brief \n * @details If you want to display debug & processing message, Define _DHCP_DEBUG_ \n * @note    If defined, it dependents on <stdio.h>\n */\n//#define _DHCP_DEBUG_  \n")),Object(i.b)("p",null,"When DHCP run in DEBUG mode, Force to be the leased time 10 seconds for\nquickly testing to maintain the leased IP. The below codes are in\n",Object(i.b)("em",{parentName:"p"},"parseDHCPMSG()"),' of "dhcp.c".'),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"   case dhcpIPaddrLeaseTime :\n      p++;\n      opt_len = *p++;\n      dhcp_lease_time  = *p++;\n      dhcp_lease_time  = (dhcp_lease_time << 8) + *p++;\n      dhcp_lease_time  = (dhcp_lease_time << 8) + *p++;\n      dhcp_lease_time  = (dhcp_lease_time << 8) + *p++;\n   #ifdef _DHCP_DEBUG_  \n      dhcp_lease_time = 10;    // <- Force to be leased time 10 secs.\n   #endif\n")),Object(i.b)("p",null,"-"," Reset the board for starting DHCP processing."),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"DHCP running",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Send DISCOVER message "),Object(i.b)("li",{parentName:"ul"},"Receive OFFER message"),Object(i.b)("li",{parentName:"ul"},"Send REQUEST message"),Object(i.b)("li",{parentName:"ul"},"Receive ACK message (when success). But Receive NACK message or\nTimeout occurred (when fail)"))),Object(i.b)("li",{parentName:"ol"},"When success",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"If first leased IP, Call the default function or yours when\ncallback is registered by reg","_","dhcp","_","cbfunc()."),Object(i.b)("li",{parentName:"ul"},"For maintaining the leased IP, Send DISCOVER message every the\nhalf of leased time.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"During this phase, If the leased IP is changed, Call the\ndefault function or yours when callback is registered by\nreg","_","dhcp","_","cbfunc()."))),Object(i.b)("li",{parentName:"ul"},"Every the leased IP, Send ARP the leased IP for checking IP\nConflict.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"When IP conflict, call the default function or yours when\ncallback is registered by reg","_","dhcp","_","cbfunc()."))))),Object(i.b)("li",{parentName:"ol"},"When failed",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"When receiving NAK message or timeout occurred after the max\ntime (",Object(i.b)("strong",{parentName:"li"},"DHCP","_","WAIT","_","TIME")," X ",Object(i.b)("strong",{parentName:"li"},"DHCP","_","RETRY","_","CNT"),") to wait\nreceive ACK or NACK message."),Object(i.b)("li",{parentName:"ul"},"The default static IP configuration applied by ",Object(i.b)("em",{parentName:"li"},"gWIZNETINFO")," in\nDHCP","_","main.c"),Object(i.b)("li",{parentName:"ul"},"Check link status of board."),Object(i.b)("li",{parentName:"ul"},"Check the MAC address to be UNIQUE"),Object(i.b)("li",{parentName:"ul"},"Check the security program as virus vaccines and fire-wall o\nyour PC."),Object(i.b)("li",{parentName:"ul"},"Check the DHCP server on the LAN belongs to the board.")))),Object(i.b)("h4",{id:"dhcp_wait_time--dhcp_retry_cnt-and-dhcp_time_handler"},"DHCP","_","WAIT","_","TIME & DHCP","_","RETRY","_","CNT And DHCP","_","time","_","handler()"),Object(i.b)("p",null,"For checking timeout to DHCP processing, Define ",Object(i.b)("em",{parentName:"p"},"DHCP","_","WAIT","_","TIME")," &\n",Object(i.b)("em",{parentName:"p"},"DHCP","_","RETRY","_","CNT")," in dhcp.h and SHOULD BE register\n",Object(i.b)("em",{parentName:"p"},"DHCP","_","time","_","handler()")," in your 1s timer handler."),Object(i.b)("p",null,"The below code is the max timeout 30s (10 sec ","*"," 3 retry count)."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"   /* Retry to processing DHCP */\n   #define  MAX_DHCP_RETRY          2        ///< Maximum retry count\n   #define  DHCP_WAIT_TIME          10       ///< Wait Time 10s\n")),Object(i.b)("p",null,"The below is example to register DHCP","_","time","_","handler() in DHCP","_","main.c"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"/**************************************************************************//**\n * @brief SysTick_Handler\n * Interrupt Service Routine for system tick counter\n *****************************************************************************/\nvoid SysTick_Handler(void)\n{\n  msTicks++;       /* increment counter necessary in Delay()*/\n  \n  ////////////////////////////////////////////////////////\n  // SHOULD BE Added DHCP Timer Handler your 1s tick timer\n  if(msTicks % 1000 == 0)  DHCP_time_handler();\n  ////////////////////////////////////////////////////////\n}\n")),Object(i.b)("h4",{id:"register-your-callback-function"},"Register your callback function"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),'/*******************************************************\n * @ brief Call back for ip assign & ip update from DHCP\n *******************************************************/\nvoid my_ip_assign(void)\n{\n   getIPfromDHCP(gWIZNETINFO.ip);\n   getGWfromDHCP(gWIZNETINFO.gw);\n   getSNfromDHCP(gWIZNETINFO.sn);\n   getDNSfromDHCP(gWIZNETINFO.dns);\n   gWIZNETINFO.dhcp = NETINFO_DHCP;\n   /* Network initialization */\n   network_init();      // apply from dhcp\n#if DEBUG_MODE != DEBUG_NO\n   printf("DHCP LEASED TIME : %d Sec.\\r\\n", getDHCPLeasetime());            \n#endif\n}\n\n/************************************\n * @ brief Call back for ip Conflict\n ************************************/\nvoid my_ip_conflict(void)\n{\n#if DEBUG_MODE != DEBUG_NO\n   printf("CONFLICT IP from DHCP\\r\\n");\n#endif   \n   //halt or reset or any...\n   while(1); // this example is halt.\n}\n\nint main(void)\n{\n  //\n  // Initialize the board\n  //\n    \n  // SHOULD BE set the UNIQUE mac before DHCP started.\n  setSHAR(gWIZNETINFO.mac);   \n  \n  DHCP_init(SOCK_DHCP, gDATABUF);\n  \n  // if you want different action instead default ip assign, update, conflict, \n  // if cbfunc == 0, act as default.\n  reg_dhcp_cbfunc(my_ip_assign,my_ip_assign,my_ip_conflict); \n  \n  while(1)\n  {\n     /// your main loop\n  }\n\n}  \n')),Object(i.b)("p",null,"If any call back function is null, Call the default function in dhcp.c"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"When ",Object(i.b)("em",{parentName:"li"},"ip","_","assign")," is null, call the ",Object(i.b)("em",{parentName:"li"},"default","_","ip","_","assign()"),". "),Object(i.b)("li",{parentName:"ul"},"When ",Object(i.b)("em",{parentName:"li"},"ip","_","update")," is null, call the ",Object(i.b)("em",{parentName:"li"},"default","_","ip","_","update()"),"."),Object(i.b)("li",{parentName:"ul"},"When ",Object(i.b)("em",{parentName:"li"},"ip","_","conflict")," is null, call the ",Object(i.b)("em",{parentName:"li"},"default","_","ip","_","conflict()"),".")),Object(i.b)("h4",{id:"the-default-static-config-when-failed"},"The Default Static Config When Failed"),Object(i.b)("p",null,"In this example, When DCHP is failed ",Object(i.b)("strong",{parentName:"p"},"MY","_","MAX","_","DHCP","_","RETRY")," times,\nApply the default static configuration as below. "),Object(i.b)("blockquote",null),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"    \\#define MY\\_MAX\\_DHCP\\_RETRY 5 //\\<- DHCP process is five times\n    attempted.\n    /\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\***\\*//**\n    \\* @brief Default Network Information\n    \\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*\\*/\n    wiz\\_NetInfo gWIZNETINFO =\n")),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"      {\n          .mac = {0x00, 0x08, 0xdc,0x00, 0xab, 0xcd},\n          .ip = {192, 168, 1, 123},\n          .sn = {255,255,255,0},\n          .gw = {192, 168, 1, 1},\n          .dns = {0,0,0,0},\n          .dhcp = NETINFO_DHCP\n      };\n")),Object(i.b)("h4",{id:"dhcp_init--dhcp_run--dhcp_stop"},"DHCP","_","init() / DHCP","_","run() / DHCP","_","stop()"),Object(i.b)("p",null,"DHCP","_","init can be called for initializing DHCP and restarting DHCP.",Object(i.b)("br",{parentName:"p"}),"\n","DHCP","_","run() SHOULD BE periodically called by your main task for the\nleased IP to maintain or check timeout.",Object(i.b)("br",{parentName:"p"}),"\n","DHCP","_","stop() can be called when DHCP doesn't process any more.",Object(i.b)("br",{parentName:"p"}),"\n","The below code shows how to use DHCP APIs."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"  /*******************************/\n  /* WIZnet W5500 Code Examples  */\n  /* DHCP test                   */\n  /*******************************/\n  /* Main loop */\n  \n  // must be set the default mac before DHCP started.\n  setSHAR(gWIZNETINFO.mac);   \n  \n  DHCP_init(SOCK_DHCP, gDATABUF);\n  // if you want different action instead default ip assign, update, conflict, \n  // if cbfunc == 0, act as default.\n  reg_dhcp_cbfunc(my_ip_assign,my_ip_assign,my_ip_conflict);  \n  \n  prevTick = msTicks;\n  \n  while(1)\n  {\n      switch(DHCP_run())\n      {\n      case DHCP_IP_ASSIGN:\n      case DHCP_IP_CHANGED:\n         /* If this block empty, act with default_ip_assign & default_ip_update  */\n         //\n         // This example calls the registered 'my_ip_assign' in the two case.\n         //\n         // Add to ...\n         //\n         break;\n      case DHCP_IP_LEASED:\n         //\n         // TO DO YOUR NETWORK APPs.\n         //\n         break;\n      case DHCP_FAILED:\n         /* ===== Example pseudo code =====  */\n         // The below code can be replaced your code or omitted.\n         // if omitted, retry to process DHCP\n         my_dhcp_retry++;\n         if(my_dhcp_retry > MY_MAX_DHCP_RETRY)\n         {\n         #if DEBUG_MODE != DEBUG_NO\n            printf(\">> DHCP %d Failed\\r\\n\",my_dhcp_retry);\n         #endif\n            my_dhcp_retry = 0;\n            DHCP_stop();      // if restart, recall DHCP_init()\n            network_init();   // apply the default static network\n         }\n         break;\n      default:\n         break;\n      }\n   }\n")),Object(i.b)("h2",{id:"dns"},"DNS"),Object(i.b)("p",null,"DNS example runs with one UDP socket. When you want to translate the\ndomain name to IP address, it is useful."),Object(i.b)("p",null,"To test the example,",Object(i.b)("br",{parentName:"p"}),"\n","Most of all, your board IP address SHOULD BE the public IP address to be\naccessible on Internet."),Object(i.b)("p",null,"If you want to monitor or display message of DNS processing, Define\nDEBUG","_","MODE in bsp","_","tg840.h (refer to the above description ",Object(i.b)("em",{parentName:"p"},'"How to\ntest',">",">",'Monitor & Debug".'),") and Define ","_","DNS","_","DEBUG","_"," in\n","[","ioLibrary",">",">","Internet",">",">","DNS",">",">","dns.h","]","."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"/*\n * @brief Define it for Debug & Monitor DNS processing.\n * @note If defined, it dependents on <stdio.h>\n */\n//#define _DNS_DEBUG_\n")),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"Reset the board for starting DNS processing"),Object(i.b)("li",{parentName:"ol"},"DNS running",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Send DNS query to DNS server"),Object(i.b)("li",{parentName:"ul"},"Receive DNS response from DNS server "))),Object(i.b)("li",{parentName:"ol"},"When success",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Available the translated IP address on your network application."))),Object(i.b)("li",{parentName:"ol"},"When fail",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"No DNS response from DNS server during the max wait time as\n",Object(i.b)("strong",{parentName:"li"},"MAX","_","DNS","_","RETRY")," X ",Object(i.b)("strong",{parentName:"li"},"DNS","_","WAIT","_","TIME")," seconds."),Object(i.b)("li",{parentName:"ul"},"When DNS failed, you can retry to another DNS server.",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Typically, 1st DNS failed, Retry to 2nd DNS. "))),Object(i.b)("li",{parentName:"ul"},"No response from all DNS server",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Check link status of board."),Object(i.b)("li",{parentName:"ul"},"Check the network configuration to access on Internet."),Object(i.b)("li",{parentName:"ul"},"Check the DNS IP address to valid.")))))),Object(i.b)("h4",{id:"max_dns_retry--dns_wiat_time-and-dns_time_handler"},"MAX","_","DNS","_","RETRY & DNS","_","WIAT","_","TIME and DNS","_","time","_","handler()"),Object(i.b)("p",null,"For checking timeout to DNS processing, Define ",Object(i.b)("em",{parentName:"p"},"MAX","_","DNS","_","RETYR")," &\n",Object(i.b)("em",{parentName:"p"},"DNS","_","WAIT","_","TIME")," in dns.h and SHOULD BE register ",Object(i.b)("em",{parentName:"p"},"DNS","_","time","_","handler()"),"\nin your 1s timer handler."),Object(i.b)("p",null,"The below code is the max timeout 6s (2 retry count ","*"," 3 seconds)"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"#define MAX_DNS_RETRY     2        ///< DNS query retry Count\n#define DNS_WAIT_TIME     3        ///< Wait response time. unit 1s.\n")),Object(i.b)("p",null,"The below code is example to register DNS","_","time","_","handler() in\nDNS","_","main.c"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),"/**************************************************************************//**\n * @brief SysTick_Handler\n * Interrupt Service Routine for system tick counter\n *****************************************************************************/\nvoid SysTick_Handler(void)\n{\n  msTicks++;       /* increment counter necessary in Delay()*/\n\n  ////////////////////////////////////////////////////////\n  // SHOULD BE Added DNS Timer Handler your 1s tick timer\n  if(msTicks % 1000 == 0)  DNS_time_handler();\n  ////////////////////////////////////////////////////////\n}\n")),Object(i.b)("h4",{id:"dns-servers--domain-name"},"DNS Servers & Domain Name"),Object(i.b)("p",null,"In this example, 1st & 2nd DNS server and Domain name are as below.\n",Object(i.b)("em",{parentName:"p"},"gWIZNETIFNO")," SHOULD BE the public IP address to access on Internet. So\nthis example maybe failed until gWIZNETINFO be modified with IP address\nto be accessible on Internet."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),'/**************************************************************************//**\n * @brief Default Network Information\n *****************************************************************************/\n/* SHOULD BE available Network information for communicating to a DNS server */\nwiz_NetInfo gWIZNETINFO = { .mac = {0x00, 0x08, 0xdc,0x00, 0xab, 0xcd},\n                            .ip = {192, 168, 1, 123},\n                            .sn = {255,255,255,0},\n                            .gw = {192, 168, 1, 1},\n                            .dns = {8,8,8,8},            // Google public DNS Server\n                            .dhcp = NETINFO_STATIC };\n\nuint8_t DNS_2nd[4]    = {168,126,63,1};      //secondary DNS server IP\nuint8_t Domain_name[] = "www.google.com";    // for example domain name\n')),Object(i.b)("p",null,"The maximum length of domain names to be converted SHOULD BE defined by\n",Object(i.b)("strong",{parentName:"p"},"MAX","_","DOMAIN","_","NAME")," in dns.h. 'MAX","_","DOAMIN","_","MAME define' should be\nincluded the number of 'null' character (one) for End of String."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),'/*\n * @brief Maximum length of your queried Domain name \n * @todo SHOULD BE defined it equal as or greater than your Domain name length + null character(1)\n * @note SHOULD BE careful to stack overflow because it is allocated 1.5 times as MAX_DOMAIN_NAME in stack.\n */\n#define  MAX_DOMAIN_NAME   16       // for example "www.google.com" \n')),Object(i.b)("h4",{id:"dns_init--dns_run"},"DNS","_","init() / DNS","_","run()"),Object(i.b)("p",null,"DNS","_","init() SHOULD be called before DHCP","_","run().",Object(i.b)("br",{parentName:"p"}),"\n","DNS","_","run() can be called for translating the domain name into IP\naddress. This is blocked until DNS process is success or failed.",Object(i.b)("br",{parentName:"p"}),"\n","The below code shows how to use DNS APIs."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-c"}),'   /* DNS client initialization */\n   DNS_init(SOCK_DNS, gDATABUF);\n   \n   /* DNS processing */\n   if ((ret = DNS_run(gWIZNETINFO.dns, Domain_name, Domain_IP)) > 0) // try to 1st DNS\n   {\n   #if DEBUG_MODE != DEBUG_NO\n      printf("> 1st DNS Response\\r\\n");\n   #endif\n   }\n   else if ((ret != -1) && ((ret = DNS_run(DNS_2nd, Domain_name, Domain_IP))>0))     // retry to 2nd DNS\n   {\n   #if DEBUG_MODE != DEBUG_NO\n      printf("> 2nd DNS Response\\r\\n");\n   #endif\n   }\n   else if(ret == -1)\n   {\n   #if DEBUG_MODE != DEBUG_NO\n      printf("> MAX_DOMAIN_NAME is too small. Should be redefined it.\\r\\n");\n   #endif\n      led_msTick = 100;\n   }\n   else\n   {\n   #if DEBUG_MODE != DEBUG_NO\n      printf("> DNS Failed\\r\\n");\n   #endif\n      led_msTick = 100;\n   }\n      \n   if(ret > 0)\n   {\n   #if DEBUG_MODE != DEBUG_NO\n      printf("> Translated %s to %d.%d.%d.%d\\r\\n",Domain_name,Domain_IP[0],Domain_IP[1],Domain_IP[2],Domain_IP[3]);\n   #endif\n      //\n      // TO DO\n      //\n   }\n')),Object(i.b)("hr",null))}p.isMDXComponent=!0},582:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return u}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=r.a.createContext({}),p=function(e){var t=r.a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=p(e.components);return r.a.createElement(o.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,o=b(e,["components","mdxType","originalType","parentName"]),s=p(n),m=a,u=s["".concat(c,".").concat(m)]||s[m]||d[m]||i;return n?r.a.createElement(u,l(l({ref:t},o),{},{components:n})):r.a.createElement(u,l({ref:t},o))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,c=new Array(i);c[0]=m;var l={};for(var b in t)hasOwnProperty.call(t,b)&&(l[b]=t[b]);l.originalType=e,l.mdxType="string"==typeof e?e:a,c[1]=l;for(var o=2;o<i;o++)c[o]=n[o];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);